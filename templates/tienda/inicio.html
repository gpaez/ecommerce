{% extends 'tienda/base.html' %}

{% block contenido %}
<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">🛍️ Productos disponibles</h1>
    <div>
      <a href="{% url 'ver_carrito' %}" class="mr-2 bg-blue-600 text-white px-4 py-2 rounded">🛒 Carrito</a>
      <a href="{% url 'historial_pedidos' %}" class="mr-2 bg-gray-600 text-white px-4 py-2 rounded">📜 Historial</a>
      {% if user.is_authenticated %}
        <span class="mr-2">👤 {{ user.username }}</span>
        <a href="{% url 'logout' %}" class="bg-red-500 text-white px-4 py-2 rounded">Cerrar sesión</a>
      {% else %}
        <a href="{% url 'login' %}" class="bg-green-600 text-white px-4 py-2 rounded">Iniciar sesión</a>
      {% endif %}
    </div>
  </div>

  <!-- Filtros -->
  <form method="get" class="grid md:grid-cols-4 gap-4 mb-6">
    <input type="text" name="q" placeholder="Buscar producto..." value="{{ request.GET.q }}" class="p-2 border rounded">
    
    <select name="categoria" class="p-2 border rounded">
      <option value="">Todas las categorías</option>
      {% for cat in categorias %}
        <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == request.GET.categoria %}selected{% endif %}>
          {{ cat.nombre }}
        </option>
      {% endfor %}
    </select>

    <input type="number" name="precio_min" placeholder="Precio mínimo" value="{{ request.GET.precio_min }}" class="p-2 border rounded">
    <input type="number" name="precio_max" placeholder="Precio máximo" value="{{ request.GET.precio_max }}" class="p-2 border rounded">

    <button type="submit" class="col-span-4 md:col-span-1 bg-blue-500 text-white p-2 rounded mt-2 md:mt-0">🔍 Filtrar</button>
  </form>

  <!-- Lista de productos -->
  <div class="grid md:grid-cols-3 gap-6">
    {% for producto in productos %}
      <div class="border rounded shadow p-4 bg-white dark:bg-gray-800 dark:text-white">
        <h3 class="text-lg font-semibold">{{ producto.nombre }}</h3>
        {% if producto.imagen %}
          <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="w-full h-48 object-cover mb-2 rounded">
        {% endif %}
        <p class="text-green-600 font-bold mb-2">{{ producto.precio }} Gs</p>
        <form action="{% url 'agregar_al_carrito' producto.id %}" method="post">
          {% csrf_token %}
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Agregar al carrito</button>
        </form>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
